<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ePhotosynthesis: Adding A New Module</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ePhotosynthesis
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/d40/newparts.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Adding A New Module</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Each module consists of a few basic parts:</p>
<ul>
<li>A condition class for holding data</li>
<li>A Vel class for holding the rate calculation results (standalone modules only)</li>
<li>Ouput functions for the condition and Vel classes</li>
<li>An initializer</li>
<li>A rate calculation function (standalone modules only)</li>
<li>A differential calculation module (MB)</li>
<li>A driver (optional)</li>
</ul>
<p>Example files for each of these are located in the templates directory. In each of the examples block comments in the code have been removed.</p>
<hr  />
 <hr  />
<h1><a class="anchor" id="helpers"></a>
Helper Macros</h1>
<p>The file <a class="el" href="../../d1/dc9/definitions_8hpp.html">definitions.hpp</a> includes three macros which can help with static class members.</p>
<hr  />
<p>The <b>`SET_GET`</b> macro is used to create the given variable (as a double) and define setter and getter functions for it. The variable will be private while the setter/getter are public.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SET_GET(NAME) public:                       \</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">       \</span></div>
<div class="line"><span class="preprocessor">  static double get ## NAME() {                     \</span></div>
<div class="line"><span class="preprocessor">    initStaticMembers();                        \</span></div>
<div class="line"><span class="preprocessor">    return NAME;                            \</span></div>
<div class="line"><span class="preprocessor">  }                                 \</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">  \</span></div>
<div class="line"><span class="preprocessor">  static void set ## NAME(const double val) {               \</span></div>
<div class="line"><span class="preprocessor">    initStaticMembers();                        \</span></div>
<div class="line"><span class="preprocessor">    setPreInit(EnumClass::NAME, val);                                   \</span></div>
<div class="line"><span class="preprocessor">    NAME = val;                             \</span></div>
<div class="line"><span class="preprocessor">  }</span></div>
</div><!-- fragment --><p>Using the macro the following code snippets are identical in function. </p><pre class="fragment">SET_GET(foo)
</pre><p>and </p><pre class="fragment">public:
    static double getFoo(){ return Foo;}
    static void setFoo(const double val) {Foo = val;}
private:
    static double Foo;
</pre><hr  />
<p>The <b>`SET_GET_BOOL`</b> macro is identical to the <b>SET_GET</b> macro, but for booleans.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SET_GET_BOOL(NAME, SKIP) public:                \</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">\</span></div>
<div class="line"><span class="preprocessor">    static bool get ## NAME() {return NAME;}\</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">\</span></div>
<div class="line"><span class="preprocessor">    static void set ## NAME(const bool val) {               \</span></div>
<div class="line"><span class="preprocessor">      NAME = val;                           \</span></div>
<div class="line"><span class="preprocessor">      if (val) {                            \</span></div>
<div class="line"><span class="preprocessor">    addSkipped(EnumClass::SKIP);                    \</span></div>
<div class="line"><span class="preprocessor">      } else {                              \</span></div>
<div class="line"><span class="preprocessor">    removeSkipped(EnumClass::SKIP);                 \</span></div>
<div class="line"><span class="preprocessor">      }                                 \</span></div>
<div class="line"><span class="preprocessor">    }                                   \</span></div>
<div class="line"><span class="preprocessor">    private:\</span></div>
<div class="line"><span class="preprocessor">        EPHOTO_API static bool NAME;</span></div>
</div><!-- fragment --><hr  />
<p>The <b>`SET_GET_BOOL_MODULE`</b> macro is used to create and manage a boolean variable in a Module class, that has an identical variable at the Condition class level.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define SET_GET_BOOL_MODULE(NAME, CON) public:\</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">\</span></div>
<div class="line"><span class="preprocessor">    static bool get ## NAME() {return NAME;}\</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">\</span></div>
<div class="line"><span class="preprocessor">    static void set ## NAME(const bool val) {\</span></div>
<div class="line"><span class="preprocessor">        NAME = val;\</span></div>
<div class="line"><span class="preprocessor">        CON ## Condition::set ## NAME(val);\</span></div>
<div class="line"><span class="preprocessor">    }\</span></div>
<div class="line"><span class="preprocessor">    private:\</span></div>
<div class="line"><span class="preprocessor">        EPHOTO_API static bool NAME;</span></div>
</div><!-- fragment --><p>The following snippets are identical in function. </p><pre class="fragment">SET_GET_BOOL_MODULE(Foo, Bar)
</pre><p>and </p><pre class="fragment">public:
    static bool getFoo() {return Foo;}
    static void setFoo(const bool val) {
        Foo = val;
        BarCondition::setFoo(val);
    }
private:
    static bool Foo;
</pre><hr  />
 <hr  />
<h1><a class="anchor" id="addsingle"></a>
Adding a Standalone Module</h1>
<p>This section describes how to add a new standalone module to the code. A standalone module is one that does not have any modules lower than it in the hierarchy. For details on adding a module which has direct dependencies see the next section.</p>
<hr  />
<h2><a class="anchor" id="addingscond"></a>
Adding A Condition</h2>
<p>Example files are detailed below. In each file replace <code>Template</code> with the name of your new condition. The header example gives the required elements of a condition class, other functions can be added as needed. The condition class headers are in include/conditions.</p>
<p>The example header file is located in <code>templates/include/conditions/TemplateCondition.hpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../d9/df2/_condition_base_8hpp.html">conditions/ConditionBase.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    4</span></div>
<div class="line"><span class="lineno">   14</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">   15</span><span class="keyword">namespace </span>conditions {</div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span><span class="keyword">class </span>Parent_Condition;</div>
<div class="line"><span class="lineno">   18</span> </div>
<div class="line"><span class="lineno">   19</span><span class="keyword">class </span>TemplateCondition : <span class="keyword">public</span> ConditionBase&lt;TemplateCondition, Parent_Condition&gt; {</div>
<div class="line"><span class="lineno">   20</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">   21</span>    TemplateCondition(Parent_Condition* par = <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   22</span>        setParent(par);</div>
<div class="line"><span class="lineno">   23</span>    }</div>
<div class="line"><span class="lineno">   29</span>    TemplateCondition(<span class="keyword">const</span> TemplateCondition* <span class="keyword">const</span> other);</div>
<div class="line"><span class="lineno">   30</span></div>
<div class="line"><span class="lineno">   37</span>    TemplateCondition(<span class="keyword">const</span> arr &amp;vec, <span class="keyword">const</span> std::size_t offset = 0);</div>
<div class="line"><span class="lineno">   38</span> </div>
<div class="line"><span class="lineno">   39</span>    <span class="comment">// Data members go here</span></div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>    std::ostream&amp; _print(std::ostream &amp;out, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/dc9/definitions_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> tab = 0) <span class="keyword">const</span>;</div>
<div class="line"><span class="lineno">   42</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">   43</span>    <span class="keyword">friend</span> ConditionBase;</div>
<div class="line"><span class="lineno">   50</span>    <span class="keywordtype">void</span> _fromArray(<span class="keyword">const</span> arr &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset = 0) <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   56</span>    arr _toArray() <span class="keyword">const override</span>;</div>
<div class="line"><span class="lineno">   57</span></div>
<div class="line"><span class="lineno">   61</span>    <span class="keyword">static</span> std::size_t _size() {</div>
<div class="line"><span class="lineno">   62</span>        <span class="keywordflow">return</span> count;</div>
<div class="line"><span class="lineno">   63</span>    }</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordtype">void</span> _clear()<span class="keyword"> override </span>{}</div>
<div class="line"><span class="lineno">   66</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> reset();</div>
<div class="line"><span class="lineno">   67</span>    <span class="comment">// the number of elements in this Condition when it is turned into a vector.</span></div>
<div class="line"><span class="lineno">   68</span>    <span class="keyword">static</span> <span class="keyword">const</span> std::size_t count;</div>
<div class="line"><span class="lineno">   69</span><span class="preprocessor">#ifdef INCDEBUG</span></div>
<div class="line"><span class="lineno">   70</span>    <span class="keyword">const</span> <span class="keyword">static</span> Debug::DebugLevel _dlevel = Debug::Low;</div>
<div class="line"><span class="lineno">   71</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   72</span>};</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>}  <span class="comment">// namespace conditions</span></div>
<div class="line"><span class="lineno">   75</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
<div class="ttc" id="a_condition_base_8hpp_html"><div class="ttname"><a href="../../d9/df2/_condition_base_8hpp.html">ConditionBase.hpp</a></div></div>
<div class="ttc" id="adefinitions_8hpp_html_a91ad9478d81a7aaf2593e8d9c3d06a14"><div class="ttname"><a href="../../d1/dc9/definitions_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a></div><div class="ttdeci">unsigned int uint</div><div class="ttdef"><b>Definition</b> <a href="../../d1/dc9/definitions_8hpp_source.html#l00062">definitions.hpp:62</a></div></div>
<div class="ttc" id="anamespacee_photosynthesis_html"><div class="ttname"><a href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a></div><div class="ttdef"><b>Definition</b> <a href="../../dd/d9b/_b_f_condition_8hpp_source.html#l00040">BFCondition.hpp:40</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">All condition classes must inherit from the <code>ConditionBase</code> class, add any other includes as needed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">14-15   </td><td class="markdownTableBodyNone">Namspacing for the library and the conditions.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">17   </td><td class="markdownTableBodyNone">Pre-declare the parent Condition (if there is one)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">19   </td><td class="markdownTableBodyNone">Condition classes must inherit from the <code>ConditionBase</code> class. The <code>ConditionBase</code> class is a template that takes two arguments, the first is the name of your new class, the second is the parent condition (the condition that holds your new condition in the data hierarchy). If this is the topmost condition then just put your new class name in for the <code>Parent_Condition</code> name.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">21-37   </td><td class="markdownTableBodyNone">The constructors, additional ones can be added, but these three must exist.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">Any condition data members should go here. They should be public to allow for ease of access from other modules. At this point they all must be <code>double</code> type or a pointer to another condition class.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">41   </td><td class="markdownTableBodyNone">The <code>_print</code> function is used to print the contents of the condition during debugging.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">43   </td><td class="markdownTableBodyNone">The base class must be noted as a friend so it can access the private functions.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">50   </td><td class="markdownTableBodyNone">The <code>_fromArray</code> function converts the input vector into the contents of the condition. The offset parameter is used when the condition's data do not start at index 0 of the input data.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">56   </td><td class="markdownTableBodyNone">The <code>_toArray</code> function is the opposite of the <code>_fromArray</code> function, converting the contents of the condition to a vector. <b>Note:</b> <code>_fromArray</code> and <code>_toArray</code> must be mirrors of each other, if vector X is sent to <code>_fromArray</code> and this output is sent to <code>_toArray</code>, the result must be equal to the input X.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">61   </td><td class="markdownTableBodyNone">Function that returns the number of data members in the condition, also this is the length of the vector returned by <code>_toArray</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">65   </td><td class="markdownTableBodyNone">Function to clear the current data members. Not usually used in lower level Condition classes.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">66   </td><td class="markdownTableBodyNone">Static function to reset all static variables to their base state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">68   </td><td class="markdownTableBodyNone">Variable to hold the number of data members.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">70   </td><td class="markdownTableBodyNone">Static variable used to hold the debugging level for this class.   </td></tr>
</table>
<p>All functions are implemented in a cpp file located in src/conditions.</p>
<p>The example implementation file is located in <code>templates/src/conditions/TemplateCondition.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;conditions/TemplateCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    5</span> </div>
<div class="line"><span class="lineno">    6</span><span class="comment">// update this with the number of data elements in the container</span></div>
<div class="line"><span class="lineno">    7</span><span class="keyword">const</span> std::size_t TemplateCondition::count = XX;</div>
<div class="line"><span class="lineno">    8</span> </div>
<div class="line"><span class="lineno">    9</span>TemplateCondition::TemplateCondition(<span class="keyword">const</span> TemplateCondition* <span class="keyword">const</span> other) {</div>
<div class="line"><span class="lineno">   10</span>    <span class="comment">// here, any data members are copied from &#39;other&#39; to this object</span></div>
<div class="line"><span class="lineno">   11</span>}</div>
<div class="line"><span class="lineno">   12</span> </div>
<div class="line"><span class="lineno">   13</span>TemplateCondition::TemplateCondition(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset) {</div>
<div class="line"><span class="lineno">   14</span>    fromArray(vec, offset);</div>
<div class="line"><span class="lineno">   15</span>}</div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span><span class="keywordtype">void</span> TemplateCondition::_fromArray(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset) {</div>
<div class="line"><span class="lineno">   18</span>    <span class="comment">// here, any data members have their values set to values in the input array</span></div>
<div class="line"><span class="lineno">   19</span>    <span class="comment">//   IMPORTANT: The order and number of the data members must be the same</span></div>
<div class="line"><span class="lineno">   20</span>    <span class="comment">//              as in the below _toArray method.</span></div>
<div class="line"><span class="lineno">   21</span> </div>
<div class="line"><span class="lineno">   22</span>}</div>
<div class="line"><span class="lineno">   23</span> </div>
<div class="line"><span class="lineno">   24</span><a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> TemplateCondition::_toArray()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">   25</span>    <span class="comment">// here any data members are copied to the output array.</span></div>
<div class="line"><span class="lineno">   26</span>    <span class="comment">//   IMPORTANT: The order and number of the data members must be the same</span></div>
<div class="line"><span class="lineno">   27</span>    <span class="comment">//              as in the above _fromArray method.</span></div>
<div class="line"><span class="lineno">   28</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><span class="lineno">   29</span>}</div>
<div class="ttc" id="anamespacee_photosynthesis_1_1conditions_html"><div class="ttname"><a href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a></div><div class="ttdef"><b>Definition</b> <a href="../../dd/d9b/_b_f_condition_8hpp_source.html#l00044">BFCondition.hpp:44</a></div></div>
<div class="ttc" id="anamespacee_photosynthesis_html_adc3c94eec1aef7ff6933bec82ced5721"><div class="ttname"><a href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">ePhotosynthesis::arr</a></div><div class="ttdeci">std::vector&lt; double &gt; arr</div><div class="ttdef"><b>Definition</b> <a href="../../d1/dc9/definitions_8hpp_source.html#l00083">definitions.hpp:83</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate header.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Set the proper namespace.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">Declare the number of items in the class (this is how long the input/output vectors to <code>_fromArray</code> and <code>_toArray</code> will be.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9-11   </td><td class="markdownTableBodyNone">Copy constructor, each item of the class should be copied individually.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">13-15   </td><td class="markdownTableBodyNone">Constructor to create the class from an input vector, this should always call <code>fromArray</code> for consistency.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">17-22   </td><td class="markdownTableBodyNone">Implementation of converting an input vector to this class.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">24-29   </td><td class="markdownTableBodyNone">Implementation of converting this class to a vector.   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="addvel"></a>
Adding a Vel Class</h2>
<p>The Vel class is used to hold the results of the rate calculations and is a header-only implementation.</p>
<p>The example header file is located in <code>templates/include/vel/TemplateVel.hpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dc9/definitions_8hpp.html">definitions.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    4</span> </div>
<div class="line"><span class="lineno">    5</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">    6</span><span class="keyword">namespace </span>vel {</div>
<div class="line"><span class="lineno">   14</span></div>
<div class="line"><span class="lineno">   18</span><span class="keyword">class </span>TemplateVel {</div>
<div class="line"><span class="lineno">   19</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">   20</span>    TemplateVel() {}</div>
<div class="line"><span class="lineno">   26</span>    TemplateVel(<span class="keyword">const</span> TemplateVel &amp;other) {</div>
<div class="line"><span class="lineno">   27</span>        <span class="comment">// copy all values from other to this container</span></div>
<div class="line"><span class="lineno">   28</span>    }</div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>    <span class="comment">// put all data members here</span></div>
<div class="line"><span class="lineno">   31</span>    <span class="comment">// all values must be of double type</span></div>
<div class="line"><span class="lineno">   32</span>    <span class="keyword">friend</span> std::ostream&amp; <a class="code hl_function" href="../../d1/d23/enums__utils_8hpp.html#a310da3b437874ef52e1925fb69b77f04">operator&lt;&lt;</a>(std::ostream&amp; out, <span class="keyword">const</span> TemplateVel &amp;in);</div>
<div class="line"><span class="lineno">   33</span>};</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>}  <span class="comment">// namespace vel</span></div>
<div class="line"><span class="lineno">   36</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
<div class="line"><span class="lineno">   37</span> </div>
<div class="ttc" id="adefinitions_8hpp_html"><div class="ttname"><a href="../../d1/dc9/definitions_8hpp.html">definitions.hpp</a></div></div>
<div class="ttc" id="aenums__utils_8hpp_html_a310da3b437874ef52e1925fb69b77f04"><div class="ttname"><a href="../../d1/d23/enums__utils_8hpp.html#a310da3b437874ef52e1925fb69b77f04">operator&lt;&lt;</a></div><div class="ttdeci">EPHOTO_API std::ostream &amp; operator&lt;&lt;(std::ostream &amp;out, const ePhotosynthesis::MODULE &amp;x)</div><div class="ttdef"><b>Definition</b> <a href="../../d8/de4/enums__utils_8cpp_source.html#l00007">enums_utils.cpp:7</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">18-19   </td><td class="markdownTableBodyNone">The class does not inherit from anything and all functions and data members are public.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">20   </td><td class="markdownTableBodyNone">Basic constructor.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">26   </td><td class="markdownTableBodyNone">Copy constructor, should copy all data member values from the input class.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">All data members should be of <b>`double`</b> type.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">Add the stream operator as a friend so the data can be output for debugging.   </td></tr>
</table>
<p>An entry for this class should be added to the Variables class in <code><a class="el" href="../../d1/dae/_variables_8hpp.html">include/Variables.hpp</a></code>. </p><pre class="fragment">TemplateVel TVel;
</pre><hr  />
<h2><a class="anchor" id="outsing"></a>
Output Functions</h2>
<p>Both the ConditionBase and TemplateVel classes declared output functions. These functions should be implemented in their own files.</p>
<p>The example Condition output can be found in <code>templates/src/output/Template_Con_output.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;conditions/TemplateCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    3</span> </div>
<div class="line"><span class="lineno">    4</span>std::ostream&amp; TemplateCondition::_print(std::ostream &amp;out, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/dc9/definitions_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> tab)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">    5</span>    <span class="keyword">const</span> std::string space(tab * 4, <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line"><span class="lineno">    6</span>    out &lt;&lt; space &lt;&lt; <span class="stringliteral">&quot;TemplateCondition&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">    7</span>    out &lt;&lt; space &lt;&lt; <span class="stringliteral">&quot;  Var1 = &quot;</span> &lt;&lt; Var1 &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">    8</span> </div>
<div class="line"><span class="lineno">    9</span>    <span class="keywordflow">return</span> out;</div>
<div class="line"><span class="lineno">   10</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4-10   </td><td class="markdownTableBodyNone">Output the class contents to the stream.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">This line is required as it allows for global control of output indentation, making the hierarchical structure visible on output.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">The name of the class should be output.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">7+   </td><td class="markdownTableBodyNone">Each data member should be output with a string giving the variable name, followed by the value.   </td></tr>
</table>
<p>The example Vel output can be found in <code>templates/src/output/Template_Vel_output.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;vel/TemplateVel.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">    4</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d8/d2a/namespacee_photosynthesis_1_1vel.html">vel</a> {</div>
<div class="line"><span class="lineno">    5</span>std::ostream&amp; <a class="code hl_function" href="../../d8/d2a/namespacee_photosynthesis_1_1vel.html#a29f6d0da260fa805d75841ee3f1abb05">operator&lt;&lt;</a>(std::ostream &amp;out, <span class="keyword">const</span> TemplateVel &amp;in) {</div>
<div class="line"><span class="lineno">    6</span>    out &lt;&lt; <span class="stringliteral">&quot;TemplateVel&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">    7</span>    out &lt;&lt; <span class="stringliteral">&quot;  Var = &quot;</span> &lt;&lt; in.var &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">    8</span> </div>
<div class="line"><span class="lineno">    9</span>    <span class="keywordflow">return</span> out;</div>
<div class="line"><span class="lineno">   10</span>}</div>
<div class="line"><span class="lineno">   11</span> </div>
<div class="line"><span class="lineno">   12</span>}  <span class="comment">// namespace vel</span></div>
<div class="line"><span class="lineno">   13</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
<div class="ttc" id="anamespacee_photosynthesis_1_1vel_html"><div class="ttname"><a href="../../d8/d2a/namespacee_photosynthesis_1_1vel.html">ePhotosynthesis::vel</a></div><div class="ttdef"><b>Definition</b> <a href="../../de/d44/_b_f_vel_8hpp_source.html#l00033">BFVel.hpp:33</a></div></div>
<div class="ttc" id="anamespacee_photosynthesis_1_1vel_html_a29f6d0da260fa805d75841ee3f1abb05"><div class="ttname"><a href="../../d8/d2a/namespacee_photosynthesis_1_1vel.html#a29f6d0da260fa805d75841ee3f1abb05">ePhotosynthesis::vel::operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;out, const BFVel &amp;in)</div><div class="ttdef"><b>Definition</b> <a href="../../df/d0e/_b_f___vel__output_8cpp_source.html#l00031">BF_Vel_output.cpp:31</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5-10   </td><td class="markdownTableBodyNone">Output the class contents to the stream.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">The class name should be output.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7+   </td><td class="markdownTableBodyNone">Each data member should be output with a string giving the variable name, followed by the value.   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="newsmod"></a>
Adding A Module</h2>
<p>An example header file is detailed below. In all files replace <code>Template</code> with the name of your new Module. The header example gives the required elements of a module class, other functions can be added as needed. The module class headers are in include/modules.</p>
<p>The example header file is located in <code>templates/include/modules/TemplateModule.hpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d0c/_module_base_8hpp.html">modules/ModuleBase.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    4</span><span class="preprocessor">#include &quot;conditions/TemplateCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    5</span> </div>
<div class="line"><span class="lineno">    6</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">    7</span><span class="keyword">namespace </span>modules {</div>
<div class="line"><span class="lineno">    8</span></div>
<div class="line"><span class="lineno">   17</span> </div>
<div class="line"><span class="lineno">   18</span><span class="keyword">class </span>TemplateModule : <span class="keyword">public</span> ModuleBase&lt;TemplateModule, conditions::TemplateCondition&gt; {</div>
<div class="line"><span class="lineno">   19</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">   20</span>    <span class="keyword">friend</span> ModuleBase;</div>
<div class="line"><span class="lineno">   27</span>    <span class="keyword">static</span> TemplateCondition* _init(Variables *theVars);</div>
<div class="line"><span class="lineno">   28</span></div>
<div class="line"><span class="lineno">   37</span>    <span class="keyword">static</span> arr _MB(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> conditions::TemplateCondition* <span class="keyword">const</span> Temp_con,</div>
<div class="line"><span class="lineno">   38</span>                   Variables *theVars);</div>
<div class="line"><span class="lineno">   39</span>    <span class="keyword">static</span> conditions::TemplateCondition* _MB_con(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> conditions::TemplateCondition* <span class="keyword">const</span> Temp_con,</div>
<div class="line"><span class="lineno">   40</span>                                                  Variables *theVars);</div>
<div class="line"><span class="lineno">   41</span></div>
<div class="line"><span class="lineno">   49</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> _Rate(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> conditions::TemplateCondition* <span class="keyword">const</span> Temp_con,</div>
<div class="line"><span class="lineno">   50</span>                      Variables *theVars);</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>};</div>
<div class="line"><span class="lineno">   53</span> </div>
<div class="line"><span class="lineno">   54</span>}  <span class="comment">// namespace modules</span></div>
<div class="line"><span class="lineno">   55</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
<div class="ttc" id="a_module_base_8hpp_html"><div class="ttname"><a href="../../de/d0c/_module_base_8hpp.html">ModuleBase.hpp</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">All module classes must inherit from the <code>ModuleBase</code> class, add any other includes as needed (the associated Condition class is also included).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">The <code>ModuleBase</code> class is a template that takes two arguments, the first is the name of your new class, the second is the name of the condition class associated with the module. The templated base class presents all the necessary public methods    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">27-50   </td><td class="markdownTableBodyNone">All methods in the module class are private, <code>ModuleBase</code> is noted as a friend to give it access to the functions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">27   </td><td class="markdownTableBodyNone">The <code>_init</code> function initializes the condition associated with this class, and returns the associated class.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">37   </td><td class="markdownTableBodyNone">The <code>_MB</code> is the differential calculation function, returning a vector of <code>dx/dt</code> values.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">The <code>_MB_con</code> is the same as the _MB function, but returns as Condition class instead. It is preferable to call the _MB_con function as it skips the steps of converting the results to an array.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">49   </td><td class="markdownTableBodyNone">The <code>_Rate</code> function does the rate calculations based on the input condition class.   </td></tr>
</table>
<p>The implementation of these functions is broken up into three separate files in src/ini, src/MB, and src/rate.</p>
<p>The example Init implementation is in <code>templates/src/ini/Template_Ini.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;modules/TemplateModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    5</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    6</span> </div>
<div class="line"><span class="lineno">    7</span>TemplateCondition* TemplateModule::_init(<a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a> *theVars) {</div>
<div class="line"><span class="lineno">    8</span>    TemplateCondition* ctnr = <span class="keyword">new</span> TemplateCondition();</div>
<div class="line"><span class="lineno">    9</span>    <span class="comment">// put any initialization code here</span></div>
<div class="line"><span class="lineno">   10</span>    <span class="keywordflow">return</span> ctnr;</div>
<div class="line"><span class="lineno">   11</span>}</div>
<div class="ttc" id="aclasse_photosynthesis_1_1_variables_html"><div class="ttname"><a href="../../da/d90/classe_photosynthesis_1_1_variables.html">ePhotosynthesis::Variables</a></div><div class="ttdef"><b>Definition</b> <a href="../../d1/dae/_variables_8hpp_source.html#l00086">Variables.hpp:86</a></div></div>
<div class="ttc" id="anamespacee_photosynthesis_1_1modules_html"><div class="ttname"><a href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d0c/_b_f_8hpp_source.html#l00037">BF.hpp:37</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate header.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-5   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7-11   </td><td class="markdownTableBodyNone">Initialize any variables and create the initial <code>TemplateCondition</code> class for feeding into the calculations.   </td></tr>
</table>
<p>The example MB implementation is in <code>templates/src/MB/Template_MB.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dae/_variables_8hpp.html">Variables.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="preprocessor">#include &quot;modules/TemplateModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    3</span> </div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    5</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    6</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    7</span> </div>
<div class="line"><span class="lineno">    8</span>TemplateCondition* TemplateModule::_MB_con(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> TemplateCondition* <span class="keyword">const</span> Temp_con, <a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a>* theVars) {</div>
<div class="line"><span class="lineno">    9</span>    <span class="comment">// do any initial work here</span></div>
<div class="line"><span class="lineno">   10</span> </div>
<div class="line"><span class="lineno">   11</span>    <span class="comment">// call the rate calculations</span></div>
<div class="line"><span class="lineno">   12</span>    Rate(t, Temp_con, theVars);</div>
<div class="line"><span class="lineno">   13</span> </div>
<div class="line"><span class="lineno">   14</span>    <span class="comment">// Create the differential results</span></div>
<div class="line"><span class="lineno">   15</span>    TemplateCondition* dydt = <span class="keyword">new</span> TemplateCondition();</div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span>    <span class="comment">// calculate the differentials</span></div>
<div class="line"><span class="lineno">   18</span><span class="preprocessor">#ifdef INCDEBUG</span></div>
<div class="line"><span class="lineno">   19</span>    <a class="code hl_define" href="../../d1/dc9/definitions_8hpp.html#a2bfd2762aabf6445ede06c60f5e9b228">DEBUG_INTERNAL</a>(dydt)</div>
<div class="line"><span class="lineno">   20</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   21</span> </div>
<div class="line"><span class="lineno">   22</span>    <span class="keywordflow">return</span> dydt;</div>
<div class="line"><span class="lineno">   23</span>}</div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span><a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> TemplateModule::_MB(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> TemplateCondition* <span class="keyword">const</span> Temp_con,</div>
<div class="line"><span class="lineno">   26</span> <a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a> *theVars) {</div>
<div class="line"><span class="lineno">   27</span>    TemplateCondition* dydt = _MB_con(t, Temp_con, theVars);</div>
<div class="line"><span class="lineno">   28</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> tmp = dydt-&gt;toArray();</div>
<div class="line"><span class="lineno">   29</span>    <span class="keyword">delete</span> dydt;</div>
<div class="line"><span class="lineno">   30</span>    <span class="keywordflow">return</span> tmp;</div>
<div class="line"><span class="lineno">   31</span>}</div>
<div class="ttc" id="a_variables_8hpp_html"><div class="ttname"><a href="../../d1/dae/_variables_8hpp.html">Variables.hpp</a></div></div>
<div class="ttc" id="adefinitions_8hpp_html_a2bfd2762aabf6445ede06c60f5e9b228"><div class="ttname"><a href="../../d1/dc9/definitions_8hpp.html#a2bfd2762aabf6445ede06c60f5e9b228">DEBUG_INTERNAL</a></div><div class="ttdeci">#define DEBUG_INTERNAL(x)</div><div class="ttdef"><b>Definition</b> <a href="../../d1/dc9/definitions_8hpp_source.html#l00167">definitions.hpp:167</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1-2   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4-6   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8-23   </td><td class="markdownTableBodyNone">Do the differential calculations.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">12   </td><td class="markdownTableBodyNone">Call the rate calculator.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">Create the class to return the differentials.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18-20   </td><td class="markdownTableBodyNone"><code>ifdef</code> statement for any debugging output.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">22   </td><td class="markdownTableBodyNone">return the differential results.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">25-31   </td><td class="markdownTableBodyNone">The version of the calculations which returns a vector instead of an object. This just calls the object version under the hood and then serializes the output.   </td></tr>
</table>
<p>The example Rate implementation is in <code>templates/src/rate/Template_Rate.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dae/_variables_8hpp.html">Variables.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="preprocessor">#include &quot;modules/TemplateModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    3</span> </div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    5</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    6</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    7</span> </div>
<div class="line"><span class="lineno">    8</span><span class="keywordtype">void</span> TemplateModule::_Rate(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> TemplateCondition* Temp_con, <a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a> *theVars) {</div>
<div class="line"><span class="lineno">    9</span>    <span class="comment">// add any rate calculation code here</span></div>
<div class="line"><span class="lineno">   10</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1-2   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4-6   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8-10   </td><td class="markdownTableBodyNone">Perform the rate calculations, the results of which go in <code>theVars-&gt;TVel</code>.   </td></tr>
</table>
<hr  />
 <hr  />
<h1><a class="anchor" id="adddep"></a>
Adding a Dependent Module</h1>
<p>This section describes how to add a new dependent module to the code. A dependent module is one that does has one or more modules lower than it in the hierarchy.</p>
<hr  />
<h2><a class="anchor" id="addingdcond"></a>
Adding A Condition</h2>
<p>Example files are detailed below. In each file replace <code>Dependent</code> with the name of your new condition. The header example gives the required elements of a condition class, other functions can be added as needed. Dependent Conditions can contain only one child Condition class, or many, the example gives details of a Condition with two child Condition classes (ACondtion and BCondition). The condition class headers are in include/conditions.</p>
<p>The example header file is located in <code>templates/include/conditions/DependentCondition.hpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;conditions/ACondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    4</span><span class="preprocessor">#include &quot;conditions/BCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    5</span></div>
<div class="line"><span class="lineno">   15</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">   16</span><span class="keyword">namespace </span>modules {</div>
<div class="line"><span class="lineno">   17</span><span class="keyword">class </span>DependentModule;</div>
<div class="line"><span class="lineno">   18</span>}</div>
<div class="line"><span class="lineno">   19</span><span class="keyword">namespace </span>conditions {</div>
<div class="line"><span class="lineno">   20</span> </div>
<div class="line"><span class="lineno">   21</span><span class="keyword">class </span>Parent_Condition;</div>
<div class="line"><span class="lineno">   22</span> </div>
<div class="line"><span class="lineno">   23</span><span class="keyword">class </span>DependentCondition : <span class="keyword">public</span> ConditionBase&lt;DependentCondition, Parent_Condition&gt; {</div>
<div class="line"><span class="lineno">   24</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">   25</span>    DependentCondition(Parent_Condition* par = <span class="keyword">nullptr</span>) : A_con(new ACondition(this)), B_con(new BCondition(this)) {</div>
<div class="line"><span class="lineno">   26</span>        setParent(par);</div>
<div class="line"><span class="lineno">   27</span>    }</div>
<div class="line"><span class="lineno">   28</span></div>
<div class="line"><span class="lineno">   34</span>    DependentCondition(<span class="keyword">const</span> DependentCondition* <span class="keyword">const</span> other);</div>
<div class="line"><span class="lineno">   35</span> </div>
<div class="line"><span class="lineno">   36</span>    DependentCondition(ACondition* aother, BCondition* bother);</div>
<div class="line"><span class="lineno">   37</span></div>
<div class="line"><span class="lineno">   44</span>    DependentCondition(<span class="keyword">const</span> arr &amp;vec, <span class="keyword">const</span> std::size_t offset = 0);</div>
<div class="line"><span class="lineno">   45</span> </div>
<div class="line"><span class="lineno">   46</span>    ~DependentCondition ()<span class="keyword"> override </span>{</div>
<div class="line"><span class="lineno">   47</span>        _clear();</div>
<div class="line"><span class="lineno">   48</span>    }</div>
<div class="line"><span class="lineno">   49</span>    <span class="comment">// Data members go here</span></div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    ACondition* A_con;</div>
<div class="line"><span class="lineno">   52</span>    BCondition* B_con;</div>
<div class="line"><span class="lineno">   53</span>    std::ostream&amp; _print(std::ostream &amp;out, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/dc9/definitions_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> tab = 0) <span class="keyword">const</span>;</div>
<div class="line"><span class="lineno">   54</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">   55</span>    <span class="keyword">friend</span> ConditionBase;</div>
<div class="line"><span class="lineno">   56</span>    <span class="keyword">friend</span> <span class="keyword">class </span>modules::DependentModule;</div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordtype">void</span> _fromArray(<span class="keyword">const</span> arr &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset = 0) <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   69</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> _toArray() <span class="keyword">const override</span>;</div>
<div class="line"><span class="lineno">   70</span></div>
<div class="line"><span class="lineno">   74</span>    <span class="keyword">static</span> std::size_t _size() {</div>
<div class="line"><span class="lineno">   75</span>        <span class="keywordflow">if</span> (count == 0)</div>
<div class="line"><span class="lineno">   76</span>            count = ACondition::size() + BCondition::size();</div>
<div class="line"><span class="lineno">   77</span>        <span class="keywordflow">return</span> count;</div>
<div class="line"><span class="lineno">   78</span>    }</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordtype">void</span> _clear() <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   81</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> reset() {</div>
<div class="line"><span class="lineno">   82</span>        count = 0;</div>
<div class="line"><span class="lineno">   83</span>    }</div>
<div class="line"><span class="lineno">   84</span>    <span class="comment">// the number of elements in this Condition when it is turned into a vector.</span></div>
<div class="line"><span class="lineno">   85</span>    <span class="keyword">static</span> std::size_t count;</div>
<div class="line"><span class="lineno">   86</span><span class="preprocessor">#ifdef INCDEBUG</span></div>
<div class="line"><span class="lineno">   87</span>    <span class="keyword">const</span> <span class="keyword">static</span> Debug::DebugLevel _dlevel = Debug::Low;</div>
<div class="line"><span class="lineno">   88</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   89</span>};</div>
<div class="line"><span class="lineno">   90</span> </div>
<div class="line"><span class="lineno">   91</span>}  <span class="comment">// namespace conditions</span></div>
<div class="line"><span class="lineno">   92</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Include appropriate headers (at least one for each sub-Condition class)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">15-19   </td><td class="markdownTableBodyNone">Namspacing for the library and the conditions.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">17   </td><td class="markdownTableBodyNone">Pre-declare the associated DependentModule class;    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">21   </td><td class="markdownTableBodyNone">Pre-declare the parent Condition (if any).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">23   </td><td class="markdownTableBodyNone">Condition classes must inherit from the <code>ConditionBase</code> class. The <code>ConditionBase</code> class is a template that takes two arguments, the first is the name of your new class, the second is the parent condition (the condition that holds your new condition in the data hierarchy). If this is the topmost condition then just put your new class name in for the <code>Parent_Condition</code> name.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">25-44   </td><td class="markdownTableBodyNone">The constructors, additional ones can be added, but these four must exist.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">The default constructor should instantiate new instances of the child classes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">36   </td><td class="markdownTableBodyNone">Unlike the standalone instance, the dependent Condition needs to have a constructor that takes any child classes as arguments.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">51+   </td><td class="markdownTableBodyNone">Any condition data members should go here. They should be public to allow for ease of access from other modules. Dependent Condition classes should have a data member for each of the child classes, and can also have their own variables of type <code>double</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">53   </td><td class="markdownTableBodyNone">The <code>_print</code> function is used to print the contents of the condition during debugging.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">55   </td><td class="markdownTableBodyNone">The base class must be noted as a friend so it can access the private functions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">56   </td><td class="markdownTableBodyNone">The associated Module class should also be added as a friend;    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">63   </td><td class="markdownTableBodyNone">The <code>_fromArray</code> function converts the input vector into the contents of the condition. The offset parameter is used when the condition's data do not start at index 0 of the input data.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">69   </td><td class="markdownTableBodyNone">The <code>_toArray</code> function is the opposite of the <code>_fromArray</code> function, converting the contents of the condition to a vector. <b>Note:</b> <code>_fromArray</code> and <code>_toArray</code> must be mirrors of each other, if vector X is sent to <code>_fromArray</code> and this output is sent to <code>_toArray</code>, the result must be equal to the input X.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">74   </td><td class="markdownTableBodyNone">Function that returns the number of data members in the condition, also this is the length of the vector returned by <code>_toArray</code>. Dependent Conditions do not hold their own size, but get it from summing the sizes of the child classes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">80   </td><td class="markdownTableBodyNone">Function to clear the current data members.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">81   </td><td class="markdownTableBodyNone">Static function to reset all static variables to their base state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">85   </td><td class="markdownTableBodyNone">Variable to hold the number of data members.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">87   </td><td class="markdownTableBodyNone">Static variable used to hold the debugging level for this class.   </td></tr>
</table>
<p>All functions are implemented in a cpp file located in src/conditions.</p>
<p>The example implementation file is located in <code>templates/src/conditions/DependentCondition.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;conditions/DependentCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    5</span> </div>
<div class="line"><span class="lineno">    6</span><span class="comment">// update this with the number of data elements in the container</span></div>
<div class="line"><span class="lineno">    7</span>std::size_t DependentCondition::count = 0;</div>
<div class="line"><span class="lineno">    8</span> </div>
<div class="line"><span class="lineno">    9</span>DependentCondition::DependentCondition(<span class="keyword">const</span> DependentCondition* <span class="keyword">const</span> other) {</div>
<div class="line"><span class="lineno">   10</span>    A_con = <span class="keyword">new</span> ACondition(other-&gt;A_con);</div>
<div class="line"><span class="lineno">   11</span>    B_con = <span class="keyword">new</span> BCondition(other-&gt;B_con);</div>
<div class="line"><span class="lineno">   12</span>    A_con-&gt;setParent(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   13</span>    B_con-&gt;setParent(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   14</span>}</div>
<div class="line"><span class="lineno">   15</span> </div>
<div class="line"><span class="lineno">   16</span>DependentCondition::DependentCondition(ACondition* aother, BCondition* bother) {</div>
<div class="line"><span class="lineno">   17</span>    <span class="keywordflow">if</span> (aother-&gt;parent == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   18</span>        A_con = aother;</div>
<div class="line"><span class="lineno">   19</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   20</span>        A_con = <span class="keyword">new</span> ACondition(aother);</div>
<div class="line"><span class="lineno">   21</span>    }</div>
<div class="line"><span class="lineno">   22</span>    <span class="keywordflow">if</span> (bother-&gt;parent == <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   23</span>        B_con = bother;</div>
<div class="line"><span class="lineno">   24</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   25</span>        B_con = <span class="keyword">new</span> BCondition(bother);</div>
<div class="line"><span class="lineno">   26</span>    }</div>
<div class="line"><span class="lineno">   27</span>    A_con-&gt;setParent(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   28</span>    B_con-&gt;setParent(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   29</span>}</div>
<div class="line"><span class="lineno">   30</span> </div>
<div class="line"><span class="lineno">   31</span>DependentCondition::DependentCondition(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset) {</div>
<div class="line"><span class="lineno">   32</span>    fromArray(vec, offset);</div>
<div class="line"><span class="lineno">   33</span>}</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span><span class="keywordtype">void</span> DependentCondition::_fromArray(<span class="keyword">const</span> <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> &amp;vec, <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset) {</div>
<div class="line"><span class="lineno">   36</span>    <span class="comment">// here, any data members have their values set to values in the input array</span></div>
<div class="line"><span class="lineno">   37</span>    <span class="comment">//   IMPORTANT: The order and number of the data members must be the same</span></div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">//              as in the below _toArray method.</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="keywordflow">if</span> (A_con == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">   40</span>        A_con = <span class="keyword">new</span> ACondition(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   41</span>    <span class="keywordflow">if</span> (B_con == <span class="keyword">nullptr</span>)</div>
<div class="line"><span class="lineno">   42</span>        B_con = <span class="keyword">new</span> BCondition(<span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   43</span>    A_con-&gt;fromArray(vec, offset);</div>
<div class="line"><span class="lineno">   44</span>    B_con-&gt;fromArray(vec, offset + ACondition::size());</div>
<div class="line"><span class="lineno">   45</span>}</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span><a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> DependentCondition::_toArray()<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">   48</span>    <span class="comment">// here any data members are copied to the output array.</span></div>
<div class="line"><span class="lineno">   49</span>    <span class="comment">//   IMPORTANT: The order and number of the data members must be the same</span></div>
<div class="line"><span class="lineno">   50</span>    <span class="comment">//              as in the above _fromArray method.</span></div>
<div class="line"><span class="lineno">   51</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> avec = A_con-&gt;toArray();</div>
<div class="line"><span class="lineno">   52</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> bvec = B_con-&gt;toArray();</div>
<div class="line"><span class="lineno">   53</span>    avec.insert(avec.end(), bvec.begin(), bvec.end());</div>
<div class="line"><span class="lineno">   54</span>    <span class="keywordflow">return</span> avec;</div>
<div class="line"><span class="lineno">   55</span>}</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span><span class="keywordtype">void</span> DependentCondition::_clear() {</div>
<div class="line"><span class="lineno">   58</span>    <span class="keywordflow">if</span> (A_con != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   59</span>        <span class="keyword">delete</span> A_con;</div>
<div class="line"><span class="lineno">   60</span>        A_con = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   61</span>    }</div>
<div class="line"><span class="lineno">   62</span>    <span class="keywordflow">if</span> (B_con != <span class="keyword">nullptr</span>) {</div>
<div class="line"><span class="lineno">   63</span>        <span class="keyword">delete</span> B_con;</div>
<div class="line"><span class="lineno">   64</span>        B_con = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="lineno">   65</span>    }</div>
<div class="line"><span class="lineno">   66</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate header.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">Set the proper namespace.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7   </td><td class="markdownTableBodyNone">Set the initial value of the size to 0. It will be calculated from the child Condition classes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9-14   </td><td class="markdownTableBodyNone">Copy constructor. Since each child Condition class instance can have only one parent, the code should copy the contents of the input classes children to new instances.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">16-29   </td><td class="markdownTableBodyNone">Constructor from the two child Condition classes. In line with the copy constructor the code checks to see if the input classes have any parent. If they do then the inputs are copied to new instances, if not then this class takes ownership of them.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">31-33   </td><td class="markdownTableBodyNone">Constructor to create the class from an input vector, this should always call <code>fromArray</code> for consistency.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">35-45   </td><td class="markdownTableBodyNone">Implementation of converting an input vector to this class. If either of the child instances are <code>nullptr</code> then a new instance is created and the input vector is given to each in turn, increasing the offset for each subsequent child.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">47-55   </td><td class="markdownTableBodyNone">Implementation of converting this class to a vector. How this is done does not matter, as long as all data members are in the correct order.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">57-66   </td><td class="markdownTableBodyNone">Function to delete the child classes if they have instances.   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="outding"></a>
Output Functions</h2>
<p>As with the standalone Condition case, an output function must be defined.</p>
<p>The example dependent Condition output can be found in <code>templates/src/output/Dependent_Con_output.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;conditions/DependentCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    3</span> </div>
<div class="line"><span class="lineno">    4</span>std::ostream&amp; DependentCondition::_print(std::ostream &amp;out, <span class="keyword">const</span> <a class="code hl_typedef" href="../../d1/dc9/definitions_8hpp.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> tab)<span class="keyword"> const </span>{</div>
<div class="line"><span class="lineno">    5</span>    <span class="keyword">const</span> std::string space(tab * 4, <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line"><span class="lineno">    6</span>    out &lt;&lt; space &lt;&lt; <span class="stringliteral">&quot;DependentCondition&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><span class="lineno">    7</span>    A_con-&gt;_print(out, tab + 1);</div>
<div class="line"><span class="lineno">    8</span>    B_con-&gt;_print(out, tab + 1);</div>
<div class="line"><span class="lineno">    9</span>    <span class="keywordflow">return</span> out;</div>
<div class="line"><span class="lineno">   10</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4-10   </td><td class="markdownTableBodyNone">Output the class contents to the stream.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">This line is required as it allows for global control of output indentation, making the hierarchical structure visible on output.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">The name of the class should be output.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">7+   </td><td class="markdownTableBodyNone">Each child Condition class's <code>_print</code> function should be called, adding 1 to the tab parameter for each. Any other data members should be output with a string giving the variable name, followed by the value.   </td></tr>
</table>
<h2><a class="anchor" id="newdmod"></a>
Adding A Module</h2>
<p>An example header file is detailed below. In all files replace <code>Dependent</code> with the name of your new Module. The header example gives the required elements of a module class, other functions can be added as needed. The module class headers are in include/modules.</p>
<p>The example header file is located in <code>templates/include/modules/DependentModule.hpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/d0c/_module_base_8hpp.html">modules/ModuleBase.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    4</span><span class="preprocessor">#include &quot;conditions/DependentCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    5</span> </div>
<div class="line"><span class="lineno">    6</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">    7</span><span class="keyword">namespace </span>modules {</div>
<div class="line"><span class="lineno">    8</span></div>
<div class="line"><span class="lineno">   17</span> </div>
<div class="line"><span class="lineno">   18</span><span class="keyword">class </span>ParentModule;</div>
<div class="line"><span class="lineno">   19</span><span class="keyword">class </span>DependentModule : <span class="keyword">public</span> ModuleBase&lt;DependentModule, conditions::DependentCondition&gt; {</div>
<div class="line"><span class="lineno">   20</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">   21</span>    <span class="keyword">friend</span> ModuleBase;</div>
<div class="line"><span class="lineno">   22</span>    <span class="keyword">friend</span> <span class="keyword">class </span>modules::ParentModule;</div>
<div class="line"><span class="lineno">   29</span>    <span class="keyword">static</span> DependentCondition* _init(Variables *theVars);</div>
<div class="line"><span class="lineno">   30</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="keyword">static</span> arr _MB(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> conditions::DependentCondition* <span class="keyword">const</span> Dep_con,</div>
<div class="line"><span class="lineno">   40</span>                   Variables *theVars);</div>
<div class="line"><span class="lineno">   41</span>    <span class="keyword">static</span> conditions::DependentCondition* _MB_con(<span class="keyword">const</span> <span class="keywordtype">double</span> t,</div>
<div class="line"><span class="lineno">   42</span>                                                   <span class="keyword">const</span> conditions::DependentCondition* <span class="keyword">const</span> Dep_con,</div>
<div class="line"><span class="lineno">   43</span>                                                   Variables *theVars);</div>
<div class="line"><span class="lineno">   44</span></div>
<div class="line"><span class="lineno">   52</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> _Rate(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> conditions::DependentCondition* <span class="keyword">const</span> Dep_con,</div>
<div class="line"><span class="lineno">   53</span>                      Variables *theVars) {}</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    <span class="keyword">static</span> <span class="keywordtype">void</span> _reset();</div>
<div class="line"><span class="lineno">   56</span>};</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>}  <span class="comment">// namespace modules</span></div>
<div class="line"><span class="lineno">   59</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3-4   </td><td class="markdownTableBodyNone">All module classes must inherit from the <code>ModuleBase</code> class, add any other includes as needed (the associated Condition class is also included).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">Pre-declare the parent Module class (if any).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">19   </td><td class="markdownTableBodyNone">The <code>ModuleBase</code> class is a template that takes two arguments, the first is the name of your new class, the second is the name of the condition class associated with the module. The templated base class presents all the necessary public methods    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">21   </td><td class="markdownTableBodyNone">The base class is declared a friend to give it access.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">22   </td><td class="markdownTableBodyNone">The parent Module class is declared a friend as well.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">29-56   </td><td class="markdownTableBodyNone">All methods in the module class are private.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">29   </td><td class="markdownTableBodyNone">The <code>_init</code> function initializes the condition associated with this class, and returns the associated class.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">39   </td><td class="markdownTableBodyNone">The <code>_MB</code> is the differential calculation function, returning a vector of <code>dx/dt</code> values.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">41   </td><td class="markdownTableBodyNone">The <code>_MB_con</code> is the same as the _MB function, but returns as Condition class instead. It is preferable to call the _MB_con function as it skips the steps of converting the results to an array.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">52   </td><td class="markdownTableBodyNone">The <code>_Rate</code> function does no work in the dependent case, and is just an empty function.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">55   </td><td class="markdownTableBodyNone">The <code>_reset</code> function will reset any static class variables to their base values.   </td></tr>
</table>
<p>The implementation of these functions is broken up into two separate files in src/ini and src/MB.</p>
<p>The example Init implementation is in <code>templates/src/ini/Dependent_Ini.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;modules/DependentModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    5</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    6</span> </div>
<div class="line"><span class="lineno">    7</span>DependentCondition* DependentModule::_init(<a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a> *theVars) {</div>
<div class="line"><span class="lineno">    8</span>    ACondition* A_con = AModule::init(theVars);</div>
<div class="line"><span class="lineno">    9</span>    BCondition* B_con = BModule::init(theVars);</div>
<div class="line"><span class="lineno">   10</span>    DependentCondition* ctnr = <span class="keyword">new</span> DependentCondition(A_con, B_con);</div>
<div class="line"><span class="lineno">   11</span>    <span class="comment">// put any initialization code here</span></div>
<div class="line"><span class="lineno">   12</span>    <span class="keywordflow">return</span> ctnr;</div>
<div class="line"><span class="lineno">   13</span>}</div>
<div class="line"><span class="lineno">   14</span> </div>
<div class="line"><span class="lineno">   15</span><span class="keywordtype">void</span> DependentModule::_reset() {</div>
<div class="line"><span class="lineno">   16</span>    AModule::_reset();</div>
<div class="line"><span class="lineno">   17</span>    BModule::_reset();</div>
<div class="line"><span class="lineno">   18</span>    conditions::DependentCondition::reset();</div>
<div class="line"><span class="lineno">   19</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Include the appropriate header.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3-5   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">7-11   </td><td class="markdownTableBodyNone">Initialize the child Conditions and use them to initialize the DependentCondition.   </td></tr>
</table>
<p>The example MB implementation is in <code>templates/src/MB/Dependent_MB.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dae/_variables_8hpp.html">Variables.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="preprocessor">#include &quot;modules/DependentModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    3</span> </div>
<div class="line"><span class="lineno">    4</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    5</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    6</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">    7</span> </div>
<div class="line"><span class="lineno">    8</span>DependentCondition* DependentModule::_MB_con(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> DependentCondition* <span class="keyword">const</span> Dep_con, <a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a>* theVars) {</div>
<div class="line"><span class="lineno">    9</span>    ACondition* A_con = Dep_con-&gt;A_con;</div>
<div class="line"><span class="lineno">   10</span>    BCondition* B_con = Dep_con-&gt;B_con;</div>
<div class="line"><span class="lineno">   11</span>    <span class="comment">// do any initial work here</span></div>
<div class="line"><span class="lineno">   12</span> </div>
<div class="line"><span class="lineno">   13</span>    <span class="comment">// call the differential calculator for the children</span></div>
<div class="line"><span class="lineno">   14</span>    ACondition* A_mb = AModule::MB_con(t, A_con, theVars);</div>
<div class="line"><span class="lineno">   15</span>    BCondition* B_mb = BModule::MB_con(t, B_con, theVars);</div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span>    <span class="comment">// Create the differential results</span></div>
<div class="line"><span class="lineno">   18</span>    DependentCondition* dydt = <span class="keyword">new</span> DependentCondition(A_mb, B_mb);</div>
<div class="line"><span class="lineno">   19</span> </div>
<div class="line"><span class="lineno">   20</span>    <span class="comment">// calculate the differentials</span></div>
<div class="line"><span class="lineno">   21</span><span class="preprocessor">#ifdef INCDEBUG</span></div>
<div class="line"><span class="lineno">   22</span>    <a class="code hl_define" href="../../d1/dc9/definitions_8hpp.html#a2bfd2762aabf6445ede06c60f5e9b228">DEBUG_INTERNAL</a>(dydt)</div>
<div class="line"><span class="lineno">   23</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span>    <span class="keywordflow">return</span> dydt;</div>
<div class="line"><span class="lineno">   26</span>}</div>
<div class="line"><span class="lineno">   27</span> </div>
<div class="line"><span class="lineno">   28</span><a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> DependentModule::_MB(<span class="keyword">const</span> <span class="keywordtype">double</span> t, <span class="keyword">const</span> DependentCondition* <span class="keyword">const</span> Dep_con,</div>
<div class="line"><span class="lineno">   29</span> <a class="code hl_class" href="../../da/d90/classe_photosynthesis_1_1_variables.html">Variables</a> *theVars) {</div>
<div class="line"><span class="lineno">   30</span>    DependentCondition* dydt = _MB_con(t, Dep_con, theVars);</div>
<div class="line"><span class="lineno">   31</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> tmp = dydt-&gt;toArray();</div>
<div class="line"><span class="lineno">   32</span>    <span class="keyword">delete</span> dydt;</div>
<div class="line"><span class="lineno">   33</span>    <span class="keywordflow">return</span> tmp;</div>
<div class="line"><span class="lineno">   34</span>}</div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1-2   </td><td class="markdownTableBodyNone">Include the appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4-6   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">8-23   </td><td class="markdownTableBodyNone">Do the differential calculations.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9-10   </td><td class="markdownTableBodyNone">Get a copy of the pointer to the input child conditions.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">14-15   </td><td class="markdownTableBodyNone">Call the differential calculators for the child Modules.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">18   </td><td class="markdownTableBodyNone">Create the class to return the differentials, based on the results of the child differentials.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">21-23   </td><td class="markdownTableBodyNone"><code>ifdef</code> statement for any debugging output.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">25   </td><td class="markdownTableBodyNone">return the differential results.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">28-34   </td><td class="markdownTableBodyNone">The version of the calculations which returns a vector instead of an object. This just calls the object version under the hood and then serializes the output.   </td></tr>
</table>
<hr  />
 <hr  />
<h1><a class="anchor" id="newdrive"></a>
Adding A New Driver</h1>
<p>The driver is the class the controls the path the processing takes. It defines the entry point in the hierarchy and returns the results of the calculations. A driver example is given in <code>templates/include/drivers/TemplateDriver.hpp</code>. In this example <code>Template</code> is interchangeable with <code>Dependent</code> in the class namings.</p>
<div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="lineno">    2</span> </div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dc9/definitions_8hpp.html">definitions.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    4</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d7e/driver_8hpp.html">drivers/driver.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    5</span><span class="preprocessor">#include &quot;conditions/TemplateCondition.hpp&quot;</span></div>
<div class="line"><span class="lineno">    6</span></div>
<div class="line"><span class="lineno">   14</span><span class="keyword">namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a> {</div>
<div class="line"><span class="lineno">   15</span><span class="keyword">namespace </span>drivers {</div>
<div class="line"><span class="lineno">   16</span><span class="keyword">class </span>TemplateDriver : <span class="keyword">public</span> Driver {</div>
<div class="line"><span class="lineno">   17</span><span class="keyword">public</span>:</div>
<div class="line"><span class="lineno">   18</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   19</span><span class="comment">      Constructor, additional variables can be added to the current initialization</span></div>
<div class="line"><span class="lineno">   20</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   21</span>    TemplateDriver(Variables *theVars, <span class="keyword">const</span> <span class="keywordtype">double</span> st, <span class="keyword">const</span> <span class="keywordtype">double</span> stp, <span class="keyword">const</span> <span class="keywordtype">double</span> etime,</div>
<div class="line"><span class="lineno">   22</span>                   <span class="keyword">const</span> <span class="keywordtype">int</span> maxSteps, <span class="keyword">const</span> <span class="keywordtype">double</span> atol, <span class="keyword">const</span> <span class="keywordtype">double</span> rtol,</div>
<div class="line"><span class="lineno">   23</span>                   <span class="keyword">const</span> <span class="keywordtype">bool</span> showWarnings = <span class="keyword">false</span>) :</div>
<div class="line"><span class="lineno">   24</span>        Driver(theVars, st, stp, etime, maxSteps, atol, rtol, showWarnings) {</div>
<div class="line"><span class="lineno">   25</span><span class="preprocessor">#ifdef INCDEBUG</span></div>
<div class="line"><span class="lineno">   26</span>        ePhotosynthesis::conditions::TemplateCondition::setTop();</div>
<div class="line"><span class="lineno">   27</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">   28</span>    }</div>
<div class="line"><span class="lineno">   29</span>    <span class="comment">// Destructor</span></div>
<div class="line"><span class="lineno">   30</span>    ~TemplateDriver() <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   31</span> </div>
<div class="line"><span class="lineno">   32</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   33</span><span class="comment">       Method to get the inputs for the initial calculation</span></div>
<div class="line"><span class="lineno">   34</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   35</span>    <span class="keywordtype">void</span> setup() <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   38</span><span class="comment">      Method to get the results and put the in a class variable.</span></div>
<div class="line"><span class="lineno">   39</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordtype">void</span> getResults() <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span><span class="keyword">private</span>:</div>
<div class="line"><span class="lineno">   43</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   44</span><span class="comment">      Method to do the calculations, this is the method given to the ODE solver</span></div>
<div class="line"><span class="lineno">   45</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   46</span>    arr MB(<a class="code hl_define" href="../../d9/df2/_condition_base_8hpp.html#a2bfd4ff53a371fad96971ef2c5bc4bf4">realtype</a> t, N_Vector u) <span class="keyword">override</span>;</div>
<div class="line"><span class="lineno">   47</span> </div>
<div class="line"><span class="lineno">   48</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   49</span><span class="comment">      Most drivers call a function to initialize the variables. If none is needed</span></div>
<div class="line"><span class="lineno">   50</span><span class="comment">      then remove the below signature. Otherwise rename the function as needed.</span></div>
<div class="line"><span class="lineno">   51</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   52</span>    TemplateCondition* Init();</div>
<div class="line"><span class="lineno">   53</span>};</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>}  <span class="comment">// namespace drivers</span></div>
<div class="line"><span class="lineno">   56</span>}  <span class="comment">// namespace ePhotosynthesis</span></div>
<div class="ttc" id="a_condition_base_8hpp_html_a2bfd4ff53a371fad96971ef2c5bc4bf4"><div class="ttname"><a href="../../d9/df2/_condition_base_8hpp.html#a2bfd4ff53a371fad96971ef2c5bc4bf4">realtype</a></div><div class="ttdeci">#define realtype</div><div class="ttdef"><b>Definition</b> <a href="../../d9/df2/_condition_base_8hpp_source.html#l00036">ConditionBase.hpp:36</a></div></div>
<div class="ttc" id="adriver_8hpp_html"><div class="ttname"><a href="../../d7/d7e/driver_8hpp.html">driver.hpp</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3-5   </td><td class="markdownTableBodyNone">Include appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">14-15   </td><td class="markdownTableBodyNone">Declare the current namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">All driver classes must inherit from the Driver base class    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">21-28   </td><td class="markdownTableBodyNone">Constructor for the class. It must have the given input parameters, but additional ones can be added.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">25-27   </td><td class="markdownTableBodyNone">Setting for debugging.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">Destructor.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">35   </td><td class="markdownTableBodyNone">The setup function prepares the condition classes for processing.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">40   </td><td class="markdownTableBodyNone">The getResults function returns the results of the calculations, placing them in a class variable.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">46   </td><td class="markdownTableBodyNone">The differential calculator function. It takes the inputs as given by the Sundials ODE framework, converts them to condition class(es) and calls the underlying _MB method for the module.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">52   </td><td class="markdownTableBodyNone">The Init function prepares and calls the underlying _init function from the module, returning the prepared condition class.   </td></tr>
</table>
<p>The driver implementation can be found in <code>templates/src/drivers/Template_driver.cpp</code>. </p><div class="fragment"><div class="line"><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dae/_variables_8hpp.html">Variables.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    2</span><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d82/globals_8hpp.html">globals.hpp</a>&quot;</span></div>
<div class="line"><span class="lineno">    3</span><span class="preprocessor">#include &quot;drivers/TemplateDriver.hpp&quot;</span></div>
<div class="line"><span class="lineno">    4</span><span class="preprocessor">#include &quot;modules/TemplateModule.hpp&quot;</span></div>
<div class="line"><span class="lineno">    5</span> </div>
<div class="line"><span class="lineno">    6</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/d3a/namespacee_photosynthesis.html">ePhotosynthesis</a>;</div>
<div class="line"><span class="lineno">    7</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../dc/ddc/namespacee_photosynthesis_1_1modules.html">ePhotosynthesis::modules</a>;</div>
<div class="line"><span class="lineno">    8</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d0/de1/namespacee_photosynthesis_1_1drivers.html">ePhotosynthesis::drivers</a>;</div>
<div class="line"><span class="lineno">    9</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="../../d2/d15/namespacee_photosynthesis_1_1conditions.html">ePhotosynthesis::conditions</a>;</div>
<div class="line"><span class="lineno">   10</span></div>
<div class="line"><span class="lineno">   16</span> </div>
<div class="line"><span class="lineno">   17</span> </div>
<div class="line"><span class="lineno">   18</span>TemplateDriver::~TemplateDriver() {</div>
<div class="line"><span class="lineno">   19</span>  modules::TemplateModule::_reset();</div>
<div class="line"><span class="lineno">   20</span>}</div>
<div class="line"><span class="lineno">   21</span> </div>
<div class="line"><span class="lineno">   22</span><span class="comment">/*</span></div>
<div class="line"><span class="lineno">   23</span><span class="comment">  This method is used to set up the inputs for the first calculation. The internal pointer theVars</span></div>
<div class="line"><span class="lineno">   24</span><span class="comment">  will contain some of the global settings. The internal array constraints will contain the initial</span></div>
<div class="line"><span class="lineno">   25</span><span class="comment">  values for the calculations.</span></div>
<div class="line"><span class="lineno">   26</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno">   27</span><span class="keywordtype">void</span> TemplateDriver::setup() {</div>
<div class="line"><span class="lineno">   28</span>    <span class="comment">// Do any initialization here</span></div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>    TemplateCondition* Temp_con = Init();</div>
<div class="line"><span class="lineno">   31</span> </div>
<div class="line"><span class="lineno">   32</span>    constraints = Temp_con-&gt;toArray(); <span class="comment">// set the initial constraints</span></div>
<div class="line"><span class="lineno">   33</span>    <span class="keyword">delete</span> Temp_con;</div>
<div class="line"><span class="lineno">   34</span>}</div>
<div class="line"><span class="lineno">   35</span> </div>
<div class="line"><span class="lineno">   36</span><span class="keywordtype">void</span> TemplateDriver::getResults() {</div>
<div class="line"><span class="lineno">   37</span>    <span class="comment">// The internal variables intermediateResults will contain the results from the last calculation run</span></div>
<div class="line"><span class="lineno">   38</span>    <span class="comment">// but this may not be the values needed as the ODE may stop one time step short of the needed</span></div>
<div class="line"><span class="lineno">   39</span>    <span class="comment">// stoping time</span></div>
<div class="line"><span class="lineno">   40</span>    TemplateCondition* Temp_con = <span class="keyword">new</span> TemplateCondition(intermediateRes);</div>
<div class="line"><span class="lineno">   41</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> tmp = TemplateModule::MB(time, Temp_con, theVars);</div>
<div class="line"><span class="lineno">   42</span>    <span class="comment">// Any final results must be stored in the results array</span></div>
<div class="line"><span class="lineno">   43</span>}</div>
<div class="line"><span class="lineno">   44</span> </div>
<div class="line"><span class="lineno">   45</span><span class="comment">/*</span></div>
<div class="line"><span class="lineno">   46</span><span class="comment">  Method to initialize variables. Comment out if not needed.</span></div>
<div class="line"><span class="lineno">   47</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno">   48</span>TemplateConditions* Init() {</div>
<div class="line"><span class="lineno">   49</span>  <span class="keywordflow">return</span> TemplateModule::init(theVars);</div>
<div class="line"><span class="lineno">   50</span>}</div>
<div class="line"><span class="lineno">   51</span><span class="comment">/*</span></div>
<div class="line"><span class="lineno">   52</span><span class="comment">  This method is the one given to the ODE solver</span></div>
<div class="line"><span class="lineno">   53</span><span class="comment">*/</span></div>
<div class="line"><span class="lineno">   54</span><a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> TemplateDriver::MB(<a class="code hl_define" href="../../d9/df2/_condition_base_8hpp.html#a2bfd4ff53a371fad96971ef2c5bc4bf4">realtype</a> t, N_Vector u) {</div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">// convert the input data into an array</span></div>
<div class="line"><span class="lineno">   56</span>    <a class="code hl_define" href="../../d9/df2/_condition_base_8hpp.html#a2bfd4ff53a371fad96971ef2c5bc4bf4">realtype</a> *x = N_VGetArrayPointer(u);</div>
<div class="line"><span class="lineno">   57</span> </div>
<div class="line"><span class="lineno">   58</span>    <span class="comment">// convert the array to an object for input into the calculations</span></div>
<div class="line"><span class="lineno">   59</span>    TemplateCondition* Temp_con = <span class="keyword">new</span> TemplateCondition(x);</div>
<div class="line"><span class="lineno">   60</span> </div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_typedef" href="../../d0/d3a/namespacee_photosynthesis.html#adc3c94eec1aef7ff6933bec82ced5721">arr</a> dxdt = TemaplateModule::MB(t, Temp_con, theVars);</div>
<div class="line"><span class="lineno">   62</span>    <span class="keyword">delete</span> Temp_con;</div>
<div class="line"><span class="lineno">   63</span> </div>
<div class="line"><span class="lineno">   64</span>    <span class="keywordflow">return</span> dxdt;</div>
<div class="line"><span class="lineno">   65</span>}</div>
<div class="ttc" id="aglobals_8hpp_html"><div class="ttname"><a href="../../d5/d82/globals_8hpp.html">globals.hpp</a></div></div>
<div class="ttc" id="anamespacee_photosynthesis_1_1drivers_html"><div class="ttname"><a href="../../d0/de1/namespacee_photosynthesis_1_1drivers.html">ePhotosynthesis::drivers</a></div><div class="ttdef"><b>Definition</b> <a href="../../db/d4b/_c_m___driver_8hpp_source.html#l00035">CM_Driver.hpp:35</a></div></div>
</div><!-- fragment --><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Line #   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1-4   </td><td class="markdownTableBodyNone">Include appropriate headers.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">6-9   </td><td class="markdownTableBodyNone">Set the namespaces.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">18-20   </td><td class="markdownTableBodyNone">The destructor should reset the module to its default state.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">27-34   </td><td class="markdownTableBodyNone">Setup the constraints before processing starts.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">36-43   </td><td class="markdownTableBodyNone">Set the code to do one last run    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">48-50   </td><td class="markdownTableBodyNone">Initialize the module.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">54-65   </td><td class="markdownTableBodyNone">Convert the input <code>N_Vector</code> to a C type, create a Conditions class from this, run the differential calculator, and return the results.   </td></tr>
</table>
<h2><a class="anchor" id="pythondrive"></a>
Exposing the New Driver in Python</h2>
<p>In order for the newly created driver to be used in Python, a new entry in <a class="el" href="../../d3/d95/wrappers_8cpp.html">src/python/wrappers.cpp</a> needs to be made. In the python::exportDrivers() function add a new entry as follows:</p>
<div class="fragment"><div class="line">bp::class_&lt;drivers::XYZ, bp::bases&lt;DriverWrap&gt;, boost::noncopyable&gt;(<span class="stringliteral">&quot;XYZ&quot;</span>, bp::init&lt;Variables*, double, double, double, int, double, double, bool&gt;()[bp::with_custodian_and_ward_postcall&lt;0,2&gt;()])</div>
<div class="line">            .def(<span class="stringliteral">&quot;run&quot;</span>, &amp;drivers::XYZ::run)</div>
<div class="line">            .def(<span class="stringliteral">&quot;setup&quot;</span>, &amp;drivers::XYZ::setup)</div>
<div class="line">            .def(<span class="stringliteral">&quot;getResults&quot;</span>, &amp;drivers::XYZ::getResults);</div>
</div><!-- fragment --><p>In the above code replace <code>XYZ</code> with the name of the new Driver class. Additionally, the call signature of the Python class will need to match that of the class constructor, so additional entries (<code>int</code>, <code>bool</code>, <code>double</code>) may be needed. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Documentation</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
